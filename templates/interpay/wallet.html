{% extends 'interpay/base.html' %}
{% load filters %}
{% load i18n %}
{% load static %}
{% load staticfiles %}
{% load currency %}
<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block flag %}

    {% endblock %}
    <title>
        {% block title %}
            Detailed -  {% trans 'Wallet Info ' %}- Interpay Iran
        {% endblock %}
    </title>
    {% block CSS %}
        <link rel="stylesheet" href="{% static 'interpay/css/wallets.css' %}">
        <link rel="stylesheet" href="{% static 'interpay/css/r1.css' %}">
        <link rel="stylesheet" href="{% static 'interpay/css/sweetalert.css' %}"/>
    {% endblock %}
    {% block JS %}
        <script type="text/javascript" src="{% static 'interpay/js/conversion.js' %}"></script>

        <script src="{% static 'interpay/jquery/jquery-1.10.2.min.js' %}"></script>
        <script src="{% static 'interpay/jquery/jquery-ui.js' %}"></script>
        <script src="{% static 'interpay/js/sweetalert.min.js' %}"></script>
        <script>
             $(document).ready(function () {
          var inf = $('#message').text();
          if( $('#message').text().length!=14)
            {
                    swal({
               title: '<div>  {% trans 'Successfully Created' %}</div> <div style="color:orange; font-size: small"> {% trans 'Click on the wallet ID if you want to see account details' %}</div><u></u> <a   {% ifequal LANGUAGE_CODE 'en-gb' %} href="/wallets/{{ account_id }}">{{account_id}}  {% else %}  href="/fa-ir/wallets/{{ account_id }}">{{account_id}} {% endifequal %}</a> ',
                    type: 'info',
               html: ' ' + 'and other HTML tags',
               type: "info",
               showCancelButton: true,
               confirmButtonColor: "#DD6B55 ",
               cancelButtonText: '{% trans 'back to current wallet'%}',
               closeOnConfirm: false,
               closeOnCancel: false,
               showConfirmButton: false,
             });
                }
            });
            var unsaved = false;
            $(":input").change(function () { //trigers change in all input fields including text type
                unsaved = false;
            });
            function unloadPage() {
                if (unsaved) {
                    return "You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?";
                }
            }
            window.onbeforeunload = unloadPage;
            function formSubmitter(formTag, messageTag) {
                swal({
                    title: '{%  trans 'Conversion' %}',
                    text: '{%  trans 'Your conversion is in process' %}',
                    type: 'info',
                    showConfirmButton: false,
                });
                document.getElementById("success").style.display = "block";
                document.getElementById(messageTag).innerHTML = "You have changed currency";
                document.getElementById("sampleform").style.display = "none";
                setTimeout("time()", 1000);
            }


            function withdrawFormSubmitter(formTag, messageTag) {
                swal({
                    title: '{%  trans 'Conversion' %}',
                    text: '{%  trans 'Your conversion is in process' %}',
                    type: 'info',
                    showConfirmButton: false,
                });
                document.getElementById("success").style.display = "block";
                document.getElementById(messageTag).innerHTML = "You have changed currency";
                document.getElementById(formTag).style.display = "none";
                setTimeout("withdraw_form_submit()", 1000);
            }


            function time() {
                document.getElementById("sampleform").submit();
            }

            function withdraw_form_submit() {
                document.getElementById("withdraw_convert_form").submit();
            }

            function set_selected_transaction(id) {
                var temp = document.getElementById("selected_transaction_id");
                temp.value = id;
            }


             function review_modal() {
                 var rate_radio = document.getElementsByName("star");

                 for (var i = 0, length = rate_radio.length; i < length; i++) {
                    if (rate_radio[i].checked) {
                    rate = rate_radio[i].value;
                    }
                }

                 var input_rate = document.getElementById("input_rate");
                 input_rate.value = rate;
                 console.log(input_rate);
                 document.getElementById("reviewform").submit();
            }
            function get_moneytransfer_id(id){
                var rform = document.getElementById("review_moneytransfer_id");
                rform.value = id
                console.log(rform);
            }
        </script>
    {% endblock %}
</head>
<body>
{% block cont-header %}
    <div>
        <h3 class="page-title">
            {% trans 'Wallet Info' %}
        </h3>
    </div>
{% endblock %}
{% block cont-body %}
    <div class="modal fade" id="ReviewModal" role="dialog">
     <div class="modal-dialog" style="width:400px;" id="rmodal">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align: center">{%  trans 'Review Details' %}</h4>
            </div>
            <div class="modal-body">
                <div class="stars">
                    <form action="{% url 'dynamic_review' %}" method="post" id="reviewform">
                    {% csrf_token %}
                        <input class="star star-5" id="star-5" type="radio" name="star" value="5"/>
                        <label class="star star-5" for="star-5"></label>
                        <input class="star star-4" id="star-4" type="radio" name="star" value="4"/>
                        <label class="star star-4" for="star-4"></label>
                        <input class="star star-3" id="star-3" type="radio" name="star" value="3"/>
                        <label class="star star-3" for="star-3"></label>
                        <input class="star star-2" id="star-2" type="radio" name="star" value="2"/>
                        <label class="star star-2" for="star-2"></label>
                        <input class="star star-1" id="star-1" type="radio" name="star" value="1"/>
                        <label class="star star-1" for="star-1"></label>
                        <input type="hidden" name="input_rate" id="input_rate">
                        <input type="hidden" id="review_moneytransfer_id" name="review_moneytransfer_id">
                        {%  trans 'Comment:' %} <input type="text" name="review_comment"/>

                    </form>
                </div>

            </div>
            <div class="modal-footer">
                       <button type="button" name="btnsubmit" value="btnsubmit"  onclick="review_modal()" class="btn btn-default"  style="float: left;">
                            {%  trans 'Submit Review' %}
                        </button>

                        <button type="button" class="btn btn-default" data-dismiss="modal" style="float: left;">
                            {%  trans 'Close' %}
                        </button>
                </div>
            </div>
        </div>
    </div>


    <div class="table-responsive">
        <table id="wal-tab" class="table">
            <thead>
            <tr class="table-header-row">
                <th class="table-header-cell" style="width:15%">
                    {% trans 'Wallet Code' %}
                </th>
                <th class="table-header-cell">
                    {% trans 'Wallet Type' %}
                </th>
                <th class="table-header-cell">
                    {% trans 'Currency Name' %}
                </th>
                <th class="table-header-cell">
                    {% trans 'Currency Symbol' %}
                </th>
                <th class="table-header-cell">
                    {% trans 'Balance' %}
                </th>
                <th class="table-header-cell">
                    {% trans 'Wallet Description' %}
                </th>
                {#                    <th  class="table-header-cell">#}
                {#                        {% trans 'Converted Value' %}#}
                {#                    </th>#}
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="table-cell" style="width:15%; text-align: center">{{ account.account_id }} </td>
                <td class="table-cell" style="text-align: center">user</td>
                <td class="table-cell" style="text-align: center"></td>
                <td class="table-cell" style="text-align: center">{{ account.cur_code }}</td>
                <td class="table-cell" style="text-align: center">{{ account.balance }}</td>
                <td class="table-cell" style="text-align: center">{{ account.name }}</td>
            </tr>
            </tbody>
        </table>
    </div>
    <div id="message">
        <a href="/wallets/{{ account_id }}">{{ message }}</a>
    </div>


    <div id="error" style="color:red">
        {{ error }}
    </div>

    <button type="button" class="btn btn-info btn-lg" data-toggle="modal"
            data-target="#Modalconvert"> {% trans 'Convert' %}</button>
    <div class="modal fade" id="Modalconvert" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title" style="text-align: center">{% trans 'Convert' %}</h4>
                </div>
                <div class="modal-body">
                    <form method="post" action="../actual_convert/" id="sampleform">
                        {% csrf_token %}

                        <div style="margin-left: 0 !important;margin-right: 0 !important;">
                            <div style="margin-right:0px;width:300px;margin-left: 10px ">
                                <label>{% trans 'Amount' %} ({{ account.cur_code }}) : </label>
                                <input id="amount" name="amount" type="text" value={{ recommended }}><br>
                                <label>{% trans 'To Currency' %}: </label>
                                <select name="currency" id="currency">
                                    <option value="EUR" selected="selected">Default(EURO)</option>
                                    {% for curr in CURRENCIES %}
                                        {% if  account.cur_code != curr.code %}
                                            <option value="{{ curr.code }}">
                                                {{ curr.symbol }} {{ curr.name }}
                                            </option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                                <input type="hidden" name="account_id" value="{{ account.account_id }}">
                                <br>
                                <input value={%  trans 'Submit' %} type='button' onclick="formSubmitter('sampleform','success')">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">{%  trans 'Close' %}</button>
                </div>
            </div>
        </div>
    </div>
    <div style="display: none; width: 80%; height: 30%" class="alert alert-success" id='success'></div>
    <hr>
    <form action="../withdraw_pending_deposit/" method="post" id="withdraw_convert_form">
        {% csrf_token %}
        <input type="hidden" name="selected_transaction_id" id="selected_transaction_id"/>
        <div class="table-responsive">
            <h3>{% trans 'Transactions' %}</h3>
            <table id="wal-tab" class="table">
                <thead>
                <tr class="table-header-row">
                    <th class="table-header-cell">
                        {% trans 'Index' %}
                    </th>
                    <th class="table-header-cell" style="width: 15%">
                        {% trans 'Date' %}
                    </th>
                    <th class="table-header-cell">
                        {% trans 'Type' %}
                    </th>
                    <th class="table-header-cell">
                        {% trans 'Amount' %}
                    </th>
                    <th class="table-header-cell">
                        {% trans 'Status' %}
                    </th>
                    <th class="table-header-cell">
                        {% trans 'Description' %}
                    </th>
                    <th class="table-header-cell">
                        {% trans 'International' %}
                    </th>
                    <th class="table-header-cell">
                        {% trans 'Transaction' %}
                    </th>
                </tr>
                </thead>
                <tbody>
                {% for d in list %}
                    <tr>
                        <td width="6%" class="table-cell" style="text-align: center">{{ forloop.counter }}</td>
                        <td width="15%" class="table-cell" style="text-align: center">{{ d.date }}</td>
                        <td class="table-cell" width="15%" style="text-align: center">
                            {{ d.type|get_type }} {% if d|get_is_deposit:user_profile %} Deposit {% else %} Withdraw {% endif %}
                        </td>

                        {% if d|get_is_deposit:user_profile %}
                            <td class="table-cell">{{ d.amount }}<span style="float:right; color:lime"
                                                                       class="glyphicon glyphicon-triangle-top green"></span>
                            </td>
                        {% elif d|get_is_withdraw:user_profile %}
                            <td class="table-cell">- {{ d.amount }}<span style="float:right; color:red"
                                                                         class="glyphicon glyphicon-triangle-bottom red"></span>
                            </td>
                        {% endif %}

                        <td class="table-cell" style="text-align: center">
                            {% if d|get_transaction_type == "deposit" %}
                                {% if d.status == 1 %}
                                    {%  trans 'Reversed' %}
                                {% elif d.status == 2 %}
                                    {%  trans 'Pending' %}
                                {% elif d.status == 3 %}
                                    {%  trans 'Completed' %}
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="table-cell">
                        {#  type 1 is payment or moneytransfer #}
                            {% if d.type == '1' %}
                                <div class="my_tooltip">
                                    {{ d|get_description}}
                                    <span class="my_tooltiptext">{{ d.payment_transfer.comment }}</span>
                                </div>

                                <button type="button" class="btn btn-info" data-toggle="modal" data-target="#ReviewModal" onclick="get_moneytransfer_id('{{ d|get_moneytransfer}}')">
                                    {% trans 'Review' %}
                                </button>

                            {% endif %}
                        </td>
                        <td class="table-cell">
                            {% if d.type == '2' %}
                                <input type="hidden" name="deposit_id{{ d.id }}" value="{{ d.id }}">

                                {% if d.status == 2 and d.type == '2'%}

                                    <button type="button" data-toggle="modal" data-target="#modal_withdraw" onclick="set_selected_transaction({{ d.id }});">Withdraw
                                    </button>




                                    <div class="modal fade" id="modal_withdraw" role="dialog">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close"
                                                            data-dismiss="modal">&times;</button>
                                                    <h4 class="modal-title">Convert to Rial</h4>
                                                </div>
                                                <div class="modal-body">
                                                    {#                    <form method="post" action="../withdraw_convert/" id="sampleform">#}
                                                    {% csrf_token %}

                                                    <div style="margin-left: 0 !important;margin-right: 0 !important;">
                                                        <div style="margin-right:0px;width:540px;margin-left: 10px ">
                                                            <div style="background-color: #ddd; padding: 2px; margin-bottom: 8px">
                                                                <b>Note:</b> In order to make the status of this payment
                                                                completed, you have to convert it to rial.
                                                            </div>
                                                            <label>{% trans 'Source Amount' %}: </label>
                                                            {{ d.amount }} {{ account.cur_code|get_currency }}s<br>
                                                            <label>{% trans 'To Currency' %}: Rial</label>
                                                            <input type="hidden" name="account_id"
                                                                   value="{{ account.account_id }}">
                                                            <br>
                                                            <label>{% trans 'Destination Amount' %}:
                                                                {{ d.amount|withdraw_convert_currency:d.cur_code}}
                                                                Rials</label>
                                                            <input type="hidden" name="account_id"
                                                                   value="{{ account.account_id }}">
                                                            <br>
                                                            <input value="Submit" type='button'
                                                                   onclick="withdrawFormSubmitter('withdraw_convert_form','success')">
                                                        </div>
                                                    </div>
                                                    {#                    </form>#}
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">
                                                        Close
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>




                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="table-cell" style="color:green;font-weight: bold">
                            {% if d|get_transaction_type == "deposit" %}
                                {% if deposit_id == d.id %}
                                    {{ transaction_status }}
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div id="message">
            <a href="/wallets/{{ account_id }}">{{ message }}</a>
        </div>

        </div>
    </form>




{% endblock %}
</body>

</html>

